<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ููุตูุฉ ุฃุญุจ ูุบุชู ูููุฑุงุกุฉ ุงููุชุฏุฑุฌุฉ</title>

  <!-- ุฎุทูุท -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ุชูุณููุงุช ุงูููุตูุฉ -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- ======= ุดุงุดุฉ ุงูุฏุฎูู / ุงูุชุณุฌูู ======= -->
  <main id="authView" class="view">
    <div class="auth-shell">
      <div class="auth-card glass">
        <h1 class="auth-title">ููุตูุฉ ุฃุญุจ ูุบุชู ูููุฑุงุกุฉ ุงููุชุฏุฑุฌุฉ</h1>
        <p class="auth-subtitle">ุณุฌูู ุฏุฎููู ูุทุงูุจ ุฃู ูุนููู ูุชุจุฏุฃ ุงูุฑุญูุฉ ูุน ุงููุตุต ูุงููุฑุงุกุฉ ุงููุชุฏุฑุฌุฉ ๐ซ</p>

        <div class="auth-tabs">
          <button class="auth-tab pill active" data-auth="login">ุชุณุฌูู ุงูุฏุฎูู</button>
          <button class="auth-tab pill" data-auth="register">ุฅูุดุงุก ุญุณุงุจ</button>
        </div>

        <!-- ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู -->
        <form id="loginForm" class="auth-form">
          <div class="form-row">
            <label for="loginEmail">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
            <input type="email" id="loginEmail" placeholder="name@example.com" required />
          </div>
          <div class="form-row">
            <label for="loginPass">ูููุฉ ุงููุฑูุฑ</label>
            <input type="password" id="loginPass" placeholder="โขโขโขโขโขโขโขโข" required />
          </div>
          <div id="loginMsg" class="form-msg"></div>
          <button type="submit" class="btn primary full">ุชุณุฌูู ุงูุฏุฎูู</button>
        </form>

        <!-- ูููุฐุฌ ุฅูุดุงุก ุญุณุงุจ -->
        <form id="regForm" class="auth-form hidden">
          <div class="form-row">
            <label for="regName">ุงูุงุณู ุงููุงูู</label>
            <input type="text" id="regName" placeholder="ุงูุชุจ ุงุณูู ุงููุงูู" required />
          </div>
          <div class="form-row">
            <label for="regEmail">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
            <input type="email" id="regEmail" placeholder="name@example.com" required />
          </div>
          <div class="form-row">
            <label for="regPass">ูููุฉ ุงููุฑูุฑ</label>
            <input type="password" id="regPass" placeholder="โขโขโขโขโขโขโขโข" required />
          </div>
          <div class="form-row">
            <label for="regRole">ุงูุฏูุฑ</label>
            <select id="regRole">
              <option value="student">ุทุงูุจ</option>
              <option value="teacher">ูุนูู</option>
            </select>
          </div>
          <div id="regMsg" class="form-msg"></div>
          <button type="submit" class="btn primary full">ุฅูุดุงุก ุงูุญุณุงุจ</button>
        </form>
      </div>
    </div>
  </main>

  <!-- ======= ูููู ุงูุชุทุจูู ุจุนุฏ ุงูุฏุฎูู ======= -->
  <div id="appShell" class="hidden">

    <!-- ุงูุดุฑูุท ุงูุนููู -->
    <header class="topbar">
      <nav class="nav">
        <div class="nav-left">
          <img class="brand-logo" src="https://home.moe.gov.om/templates/moe/assets/images/sliders/others/MOE.png" alt="ุดุนุงุฑ ุงููุฒุงุฑุฉ" />
          <div class="brand-text">
            <span class="brand-title">ููุตูุฉ ุฃุญุจ ูุบุชู ูููุฑุงุกุฉ ุงููุชุฏุฑุฌุฉ</span>
            <small class="brand-sub">ูุฒุงุฑุฉ ุงูุชุฑุจูุฉ ูุงูุชุนููู - ุณูุทูุฉ ุนููุงู</small>
          </div>
        </div>

        <div class="nav-center" id="navLinks">
          <!-- ููุจูู ุฏููุงูููููุง ูู app.js -->
        </div>

        <div class="nav-right">
          <div class="nav-user">
            <div class="nav-avatar">
              <img id="userAvatar" src="img/avatar-student-omani.png" alt="ุฃููููุฉ ูุณุชุฎุฏู" />
            </div>
            <div class="nav-user-info">
              <div id="userName" class="nav-user-name">โ</div>
              <small id="userRoleLabel" class="nav-user-role">โ</small>
            </div>
          </div>
          <button id="btnLogout" class="btn ghost small">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
        </div>
      </nav>
    </header>

    <!-- ูุญุชูู ุงูุชุทุจูู: ุณูุฉ ูููู + ุงููุญุชูู -->
    <main id="mainLayout">
      <aside class="rail">
        <div class="profile-card glass">
          <div class="avatar">
            <!-- ูุณุชุฎุฏู ููุณ ุงูุตูุฑุฉ ุงูุตุบูุฑุฉ ููุง ุฃูุถูุง ุฅู ุฃุฑุฏุช -->
            <img id="railAvatar" src="img/avatar-student-omani.png" alt="ุฃููููุฉ ุงููุณุชุฎุฏู" />
          </div>
          <div class="pname">
            <strong id="helloName">ูุฑุญุจูุง!</strong>
            <small id="railRoleText">โ</small>
          </div>
        </div>

        <div class="score-card glass">
          <h3>ุจูุงูุงุช ุงููุฑุงุกุฉ</h3>
          <div class="rail-grid">
            <div>
              <span class="label">ุนุฏุฏ ุงููุตุต ุงูููุฑูุกุฉ</span>
              <span id="railBooks" class="value">0</span>
            </div>
            <div>
              <span class="label">ุฒูู ุงููุฑุงุกุฉ</span>
              <span id="railTime" class="value">0 ุฏ</span>
            </div>
            <div>
              <span class="label">ุงูุดุงุฑุงุช</span>
              <span id="railBadges" class="value">0</span>
            </div>
            <div>
              <span class="label">ูุชูุณุท ุงูุฏูููุฉ/ูุตุฉ</span>
              <span id="railAvg" class="value">0 ุฏ</span>
            </div>
            <div>
              <span class="label">ุขุฎุฑ ูุตุฉ</span>
              <span id="railLastBook" class="value">โ</span>
            </div>
            <div>
              <span class="label">ุฃูุดุทุฉ ููุฌุฒุฉ</span>
              <span id="railActs" class="value">0</span>
            </div>
          </div>
        </div>
      </aside>

      <section class="main">
        <!-- ุชุจููุจุงุช (Views) -->
        <section id="tab-home" class="view">
          <div class="glass section-card">
            <h2>ูุฑุญุจูุง ุจู ูู ููุตูุฉ ุฃุญุจ ูุบุชู ๐</h2>
            <p>ููููู ูู ููุง ุงูุงูุชูุงู ุฅูู ุงููุณุชููุงุชุ ุฃู ุงูููุชุจุฉุ ุฃู ูุงุฌุจุงุชูุ ุฃู ุชูุงุฑูุฑู.</p>
          </div>
        </section>

        <section id="tab-levels" class="view hidden">
          <div class="section-header">
            <h2>ุงููุณุชููุงุช ุงููุฑุงุฆูุฉ</h2>
            <p>ุงุฎุชุฑ ูุณุชูู ุงููุฑุงุกุฉ ุงูููุงุณุจ ูู.</p>
          </div>
          <div id="levelsGrid" class="levels-grid"></div>
        </section>

        <section id="tab-library" class="view hidden">
          <div class="section-header">
            <h2>ุงูููุชุจุฉ</h2>
            <div class="section-actions">
              <input id="searchBooks" type="search" placeholder="ุงุจุญุซ ุนู ูุตุฉ..." />
              <button id="btnAddBook" class="btn small only-teacher">โ ุฅุถุงูุฉ ูุตุฉ</button>
            </div>
          </div>
          <div id="booksGrid" class="books-grid"></div>
        </section>

        <section id="tab-assign" class="view hidden">
          <div class="section-header">
            <h2>ูุงุฌุจุงุชู</h2>
          </div>
          <div class="assign-filters">
            <button class="pill small" data-filter="required">ุงููุงุฌุจุงุช ุงููุทููุจุฉ</button>
            <button class="pill small" data-filter="done">ุงูููุฌุฒุฉ</button>
            <button class="pill small" data-filter="overdue">ุงููุชุฃุฎุฑุฉ</button>
          </div>
          <div id="assignList" class="assign-list"></div>
        </section>

        <section id="tab-teacher" class="view hidden">
          <div class="section-header">
            <h2>ููุญุฉ ุงููุนูู</h2>
            <p>ูุชูุณุท ุฅูุฌุงุฒ ุทูุงุจ ุงููุตู.</p>
          </div>
          <div class="glass section-card">
            <canvas id="chartAvgProgress" width="200" height="200"></canvas>
          </div>
        </section>

        <section id="tab-teacher-students" class="view hidden">
          <div class="section-header">
            <h2>ุทูุงุจ ุงููุตู</h2>
            <button id="btnAddStudent" class="btn small only-teacher">โ ุฅุถุงูุฉ ุทุงูุจ</button>
          </div>
          <div class="table-header">
            <div>ุงูุงุณู</div>
            <div>ุงูุจุฑูุฏ</div>
            <div>ุงูุตู</div>
            <div>ุฅุฌุฑุงุกุงุช</div>
          </div>
          <div id="studentsRows" class="table-rows"></div>
        </section>

        <section id="tab-teacher-assignments" class="view hidden">
          <div class="section-header">
            <h2>ุฅุฏุงุฑุฉ ุงููุงุฌุจุงุช</h2>
            <button id="btnCreateAssign" class="btn small only-teacher">โ ุฅูุดุงุก ูุงุฌุจ</button>
          </div>
          <div class="table-header">
            <div>ุงูุทุงูุจ</div>
            <div>ุนููุงู ุงููุงุฌุจ</div>
            <div>ุงูุญุงูุฉ</div>
            <div>ุงูุชูุฏูู</div>
            <div>ููุงุญุธุฉ</div>
            <div>ุฅุฌุฑุงุกุงุช</div>
          </div>
          <div id="teacherRows" class="table-rows"></div>
        </section>

        <section id="tab-reports" class="view hidden">
          <div class="section-header">
            <h2>ุชูุงุฑูุฑู</h2>
          </div>
          <div class="reports-grid">
            <div class="glass stat-card">
              <span class="label">ูุณุจุฉ ุฅูุฌุงุฒ ุงููุตุต</span>
              <span id="repPercent" class="value big">0%</span>
            </div>
            <div class="glass stat-card">
              <span class="label">ุนุฏุฏ ุงููุตุต ุงูููุฑูุกุฉ</span>
              <span id="repReads" class="value big">0</span>
            </div>
            <div class="glass stat-card">
              <span class="label">ุฅุฌูุงูู ุฒูู ุงููุฑุงุกุฉ</span>
              <span id="repTime" class="value big">0 ุฏูููุฉ</span>
            </div>
          </div>
          <div class="glass section-card">
            <canvas id="chartReads" height="220"></canvas>
          </div>
        </section>
      </section>
    </main>
  </div>

  <!-- ======= ูุงุฑุฆ ุงููุตุฉ ======= -->
  <div id="readerView" class="view hidden">
    <div class="reader-shell">
      <div class="reader-header">
        <button class="btn ghost small" onclick="backToApp()">โฌ ุงูุนูุฏุฉ ููููุตูุฉ</button>
        <div class="reader-meta">
          <h2 id="storyTitle">ุนููุงู ุงููุตุฉ</h2>
          <span id="storyLevel" class="badge">ุงููุณุชูู โ</span>
        </div>
      </div>

      <div class="reader-body glass">
        <div class="reader-cover">
          <img id="storyCover" src="" alt="ุบูุงู ุงููุตุฉ" />
        </div>
        <div id="storyContent" class="reader-text">
          <!-- ููููุฃ ูุต ุงููุตุฉ ูู app.js -->
        </div>
      </div>

      <div class="reader-footer glass">
        <div class="record-controls">
          <span id="recordTime">โฑ๏ธ 00:00</span>
          <div class="record-buttons">
            <button id="startRec" class="btn small">๐ ุจุฏุก ุงูุชุณุฌูู</button>
            <button id="stopRec" class="btn small hidden">โน ุฅููุงู</button>
            <button id="playRec" class="btn small hidden">โถ ุชุดุบูู ุงูุชุณุฌูู</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ======= ูุงูุฐุฉ ุฅุถุงูุฉ ุทุงูุจ ======= -->
  <div id="modalStudent" class="modal hidden">
    <div class="modal-card">
      <button class="modal-close" onclick="document.getElementById('modalStudent').classList.add('hidden')">โ</button>
      <h3>ุฅุถุงูุฉ ุทุงูุจ ุฌุฏูุฏ</h3>
      <div class="form-row">
        <label>ุงูุงุณู ุงููุงูู</label>
        <input type="text" id="sName" />
      </div>
      <div class="form-row">
        <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
        <input type="email" id="sEmail" />
      </div>
      <div class="form-row">
        <label>ุงูุตู</label>
        <input type="text" id="sClass" placeholder="ูุซูุงู: ุงูุตู ุงูุณุงุฏุณ" />
      </div>
      <div class="form-row">
        <label>ูููุฉ ุงููุฑูุฑ (ุงุฎุชูุงุฑู)</label>
        <input type="text" id="sPass" value="123456" />
      </div>
      <button class="btn primary full" onclick="saveStudent()">ุญูุธ ุงูุทุงูุจ</button>
    </div>
  </div>

  <!-- ======= ูุงูุฐุฉ ุฅูุดุงุก ูุงุฌุจ ======= -->
  <div id="modalAssign" class="modal hidden">
    <div class="modal-card">
      <button class="modal-close" onclick="document.getElementById('modalAssign').classList.add('hidden')">โ</button>
      <h3>ุฅูุดุงุก ูุงุฌุจ ุฌุฏูุฏ</h3>
      <div class="form-row">
        <label>ุนููุงู ุงููุงุฌุจ</label>
        <input type="text" id="aTitle" />
      </div>
      <div class="form-row">
        <label>ุงููุณุชูู</label>
        <select id="aLevel"></select>
      </div>
      <div class="form-row">
        <label>ุชุงุฑูุฎ ุงูุชุณููู</label>
        <input type="date" id="aDue" />
      </div>
      <div class="form-row">
        <label>ูุตู ุงููุงุฌุจ</label>
        <textarea id="aDesc" rows="3"></textarea>
      </div>
      <div class="form-row">
        <label>ุงูุทูุงุจ</label>
        <div id="studentsChecklist" class="checklist"></div>
      </div>
      <button class="btn primary full" onclick="saveAssignment()">ุญูุธ ุงููุงุฌุจ</button>
    </div>
  </div>

  <!-- ======= ูุงูุฐุฉ ุฅุถุงูุฉ ูุตุฉ ======= -->
  <div id="modalBook" class="modal hidden">
    <div class="modal-card">
      <button class="modal-close" onclick="document.getElementById('modalBook').classList.add('hidden')">โ</button>
      <h3>ุฅุถุงูุฉ ูุตุฉ ุฌุฏูุฏุฉ</h3>
      <div class="form-row">
        <label>ุนููุงู ุงููุตุฉ</label>
        <input type="text" id="bTitle" />
      </div>
      <div class="form-row">
        <label>ุงููุณุชูู</label>
        <select id="bLevel">
          <option value="L1">ุงููุณุชูู 1</option>
          <option value="L2">ุงููุณุชูู 2</option>
          <option value="L3">ุงููุณุชูู 3</option>
          <option value="L4">ุงููุณุชูู 4</option>
        </select>
      </div>
      <div class="form-row">
        <label>ุฑุงุจุท ุงูุบูุงู (ุงุฎุชูุงุฑู)</label>
        <input type="text" id="bCover" placeholder="https://..." />
      </div>
      <div class="form-row">
        <label>ุฑูุน ุตูุฑุฉ ุบูุงู (ุงุฎุชูุงุฑู)</label>
        <input type="file" id="bFile" accept="image/*" />
      </div>
      <div class="form-row">
        <label>ูุต ุงููุตุฉ (ูู ููุฑุฉ ูู ุณุทุฑ)</label>
        <textarea id="bText" rows="6"></textarea>
      </div>
      <button class="btn primary full" onclick="saveBook()">ุญูุธ ุงููุตุฉ</button>
    </div>
  </div>

  <!-- ======= ูุงูุฐุฉ ุฅุถุงูุฉ ุฃุณุฆูุฉ ูููุตุฉ ======= -->
  <div id="modalQuizEditor" class="modal hidden">
    <div class="modal-card">
      <button class="modal-close" onclick="document.getElementById('modalQuizEditor').classList.add('hidden')">โ</button>
      <h3>ุฅุถุงูุฉ ุณุคุงู ูููุตุฉ</h3>
      <div class="form-row">
        <label>ุงุฎุชุฑ ุงููุตุฉ</label>
        <select id="qBookSelect"></select>
      </div>
      <div class="form-row">
        <label>ูุต ุงูุณุคุงู</label>
        <textarea id="qText" rows="2"></textarea>
      </div>
      <div class="form-row">
        <label>ุงูุฎูุงุฑุงุช (ูู ุฎูุงุฑ ูู ุณุทุฑ)</label>
        <textarea id="qOptions" rows="4"></textarea>
      </div>
      <div class="form-row">
        <label>ุฑูู ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ (0 = ุงูุฎูุงุฑ ุงูุฃูู)</label>
        <input type="number" id="qCorrect" />
      </div>
      <button class="btn primary full" onclick="saveQuiz()">ุญูุธ ุงูุณุคุงู</button>
    </div>
  </div>

  <!-- ======= Firebase + Firestore ุฅุนุฏุงุฏ ======= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCcgfkdGNTZhqPxoY765hf53jh9KqOQPxU",
      authDomain: "my-language2025.firebaseapp.com",
      projectId: "my-language2025",
      storageBucket: "my-language2025.appspot.com",
      messagingSenderId: "1060862300996",
      appId: "1:1060862300996:web:xxxxxxxxxxxxxxxxxxxxxx"
    };

    const app = initializeApp(firebaseConfig);
    window.db = getFirestore(app);
  </script>

  <!-- ======= ุณูุฑุจุช ุงูููุตูุฉ ======= -->
  <script type="module" src="app.js"></script>
</body>
</html>
